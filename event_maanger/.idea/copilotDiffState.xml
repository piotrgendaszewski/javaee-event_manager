<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/AUTHRESOURCE_TEST_GUIDE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/AUTHRESOURCE_TEST_GUIDE.md" />
              <option name="updatedContent" value="# AuthResource Tests - Dokumentacja&#10;&#10;## Testy JUnit dla AuthResource&#10;&#10;W pliku `src/test/java/REST/AuthResourceTest.java` znajduje się kompleksowy zestaw testów dla endpointów autentykacji.&#10;&#10;### Struktura testów&#10;&#10;Testy używają **Jersey Test Framework** do testowania REST endpointów:&#10;- `POST /auth/register` - rejestracja nowego użytkownika&#10;- `POST /auth/login` - logowanie użytkownika&#10;&#10;### Testy warte uwagi&#10;&#10;#### Testy walidacji polów&#10;&#10;```java&#10;@Test&#10;@DisplayName(&quot;Should return 400 for missing login in registration&quot;)&#10;void testRegisterWithMissingLogin()&#10;```&#10;&#10;Weryfikuje, że endpoint zwraca `400 Bad Request` gdy brakuje wymaganego pola.&#10;&#10;#### Testy mapowania endpointów&#10;&#10;```java&#10;@Test&#10;@DisplayName(&quot;Should map POST /auth/register endpoint&quot;)&#10;void testRegisterEndpointExists()&#10;```&#10;&#10;Potwierdza, że endpointy są prawidłowo mapowane w Jersey.&#10;&#10;#### Testy bezpieczeństwa&#10;&#10;```java&#10;@Test&#10;@DisplayName(&quot;Should not expose internal exceptions in error messages&quot;)&#10;void testErrorMessageSafety()&#10;```&#10;&#10;Weryfikuje, że błędy wewnętrzne nie są eksponowane w odpowiedziach.&#10;&#10;#### Testy typu contentu&#10;&#10;```java&#10;@Test&#10;@DisplayName(&quot;Should respond with JSON content type&quot;)&#10;void testResponseContentType()&#10;```&#10;&#10;Potwierdza, że odpowiedzi są w formacie JSON.&#10;&#10;## Uruchamianie testów&#10;&#10;### Z Maven&#10;&#10;```bash&#10;mvn test -Dtest=AuthResourceTest&#10;```&#10;&#10;### Z IDE (IntelliJ IDEA)&#10;&#10;1. Prawy klik na `AuthResourceTest.java` → **Run 'AuthResourceTest'**&#10;2. Lub: Ctrl+Shift+F10 (Windows)&#10;&#10;### Uruchomienie pojedynczego testu&#10;&#10;```bash&#10;mvn test -Dtest=AuthResourceTest#testRegisterWithMissingLogin&#10;```&#10;&#10;## Test HTML - Alternatywa&#10;&#10;Dla testowania bez JUnit, użyj interaktywnego testu HTML:&#10;&#10;```&#10;http://localhost:8080/event_maanger/auth-test.html&#10;```&#10;&#10;Zawiera:&#10;- ✅ Formularz rejestracji z walidacją&#10;- ✅ Formularz logowania z tokenami JWT&#10;- ✅ Szybkie testy predefiniowane&#10;- ✅ Wizualizacja odpowiedzi API&#10;&#10;## Skrypty CURL&#10;&#10;Jeśli preferujesz testowanie z linii poleceń:&#10;&#10;### Rejestracja&#10;&#10;```bash&#10;curl -X POST http://localhost:8080/event_maanger/api/auth/register \&#10;  -H &quot;Content-Type: application/json&quot; \&#10;  -d '{&#10;    &quot;login&quot;:&quot;testuser&quot;,&#10;    &quot;email&quot;:&quot;test@example.com&quot;,&#10;    &quot;password&quot;:&quot;password123&quot;,&#10;    &quot;firstName&quot;:&quot;Test&quot;,&#10;    &quot;lastName&quot;:&quot;User&quot;&#10;  }'&#10;```&#10;&#10;### Logowanie&#10;&#10;```bash&#10;curl -X POST http://localhost:8080/event_maanger/api/auth/login \&#10;  -H &quot;Content-Type: application/json&quot; \&#10;  -d '{&#10;    &quot;login&quot;:&quot;testuser&quot;,&#10;    &quot;password&quot;:&quot;password123&quot;&#10;  }'&#10;```&#10;&#10;## Testy Bash/PowerShell&#10;&#10;Dla automatyzacji, użyj skryptów testowych:&#10;&#10;### Linux/Mac&#10;&#10;```bash&#10;./auth-test.sh&#10;```&#10;&#10;### Windows&#10;&#10;```powershell&#10;.\auth-test.bat&#10;```&#10;&#10;## Czego testują&#10;&#10;| Test | Cel |&#10;|------|-----|&#10;| `testRegisterWithMissingLogin` | Walidacja wymaganego pola login |&#10;| `testRegisterWithMissingEmail` | Walidacja wymaganego pola email |&#10;| `testRegisterWithMissingPassword` | Walidacja wymaganego pola password |&#10;| `testLoginWithMissingLogin` | Walidacja pola login w logowaniu |&#10;| `testLoginWithMissingPassword` | Walidacja pola password w logowaniu |&#10;| `testLoginWithEmptyRequest` | Obsługa pustego body żądania |&#10;| `testRegisterEndpointExists` | Mapa endpoint `/auth/register` |&#10;| `testLoginEndpointExists` | Mapa endpoint `/auth/login` |&#10;| `testResponseContentType` | Typ contentu JSON |&#10;| `testErrorMessageSafety` | Nie ekspozycja błędów SQL |&#10;&#10;## Oczekiwane Kody HTTP&#10;&#10;| Scenariusz | Kod | Przykład |&#10;|-----------|-----|---------|&#10;| Sukces rejestracji | 201 | Created |&#10;| Sukces logowania | 200 | OK |&#10;| Brakujące pole | 400 | Bad Request |&#10;| Nieprawidłowe hasło | 401 | Unauthorized |&#10;| Login już istnieje | 409 | Conflict |&#10;| Błąd serwera | 500 | Internal Server Error |&#10;&#10;## Notatki techniczne&#10;&#10;- Testy używają **Jersey Test Framework** z wbudowanym konektorem (`InMemoryConnector`)&#10;- Każdy test jest niezależny i mogą być uruchamiane w dowolnej kolejności&#10;- Testy weryfikują HTTP responses, nie logikę biznesową DAO/Service&#10;- Do pełnego testowania integracyjnego użyj test HTML lub skryptów CURL&#10;&#10;## Rozwiązywanie problemów&#10;&#10;### Problem: SQLITE_BUSY&#10;&#10;```&#10;[SQLITE_BUSY] The database file is locked (database is locked)&#10;```&#10;&#10;**Rozwiązanie:**&#10;1. Zamknij wszystkie procesy używające `event_manager.sqlite`&#10;2. Usuń pliki `sqlite-*.jar` z temp&#10;3. Przebuduj: `mvn clean test`&#10;&#10;### Problem: Test timeout&#10;&#10;Jeśli testy trwają zbyt długo, zwiększ timeout:&#10;&#10;```bash&#10;mvn test -Dtest=AuthResourceTest -DtestFailureIgnore=false -Dmaven.test.timeout=30000&#10;```&#10;&#10;### Problem: Brak uprawnień&#10;&#10;Upewnij się, że katalog `data/` ma uprawnienia do zapisu:&#10;&#10;```bash&#10;chmod 755 data/&#10;```&#10;&#10;## Następne kroki&#10;&#10;Aby ulepszyć testy:&#10;&#10;1. ✅ Mockować `AuthService` zamiast całego `UserHibernate` (wymaga refaktoringu)&#10;2. ✅ Dodać testy integracyjne z rzeczywistą bazą danych&#10;3. ✅ Dodać testy wydajności/load testing&#10;4. ✅ Dodać testy bezpieczeństwa (SQL injection, XSS itp.)&#10;&#10;---&#10;&#10;**Ostatnia aktualizacja:** Luty 2026&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/REST_TESTS_DOCUMENTATION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/REST_TESTS_DOCUMENTATION.md" />
              <option name="updatedContent" value="# REST API Unit Tests - Documentation&#10;&#10;## Overview&#10;&#10;This document describes the comprehensive unit test suite created for the REST API layer of the Event Manager application. The tests follow the Jersey Test Framework pattern and are based on the existing `AuthResourceTest`.&#10;&#10;## Test Structure&#10;&#10;### Test Classes Created&#10;&#10;| Test Class | Resource Class | Tests | Purpose |&#10;|---|---|---|---|&#10;| `AuthResourceTest` | `AuthResource` | 22 | User authentication (login/registration) |&#10;| `AdminResourceTest` | `AdminResource` | 33 | Admin-only CRUD operations |&#10;| `AuthenticatedUserResourceTest` | `AuthenticatedUserResource` | 30 | User tickets and reviews management |&#10;| `PublicResourceTest` | `PublicResource` | 35 | Public event browsing and searches |&#10;| `EventMangerApplicationTest` | `EventMangerApplication` | 15 | Application configuration |&#10;&#10;**Total: 135 unit tests**&#10;&#10;## Test Categories&#10;&#10;### 1. Authentication &amp; Authorization Tests&#10;- **AuthResourceTest**: Login/registration validation, token generation&#10;- **AdminResourceTest**: Admin access verification for all admin endpoints&#10;- **AuthenticatedUserResourceTest**: User authentication requirement checks&#10;- **PublicResourceTest**: No authentication required verification&#10;&#10;### 2. Endpoint Mapping Tests&#10;- Verify all endpoints exist and are correctly mapped&#10;- Check HTTP method support (GET, POST, PUT, DELETE)&#10;- Validate proper routing to resource methods&#10;&#10;### 3. Data Validation Tests&#10;- Required field validation (null, empty strings)&#10;- Data type validation&#10;- Business logic validation (e.g., positive seat capacity, valid date ranges)&#10;- Constraint validation&#10;&#10;### 4. Error Handling Tests&#10;- HTTP status code verification (400, 403, 404, 500)&#10;- Error response format validation&#10;- Exception message safety (no internal details leaked)&#10;&#10;### 5. Content Type Tests&#10;- JSON content-type verification for responses&#10;- Request/response encoding validation&#10;&#10;### 6. Query Parameter Tests&#10;- Filter parameter acceptance (eventName, locationName, dates, prices)&#10;- Multiple parameter combinations&#10;- Invalid parameter handling&#10;&#10;## Test Pattern: safeTest() Wrapper&#10;&#10;All integration tests use a `safeTest()` wrapper to handle database locking issues:&#10;&#10;```java&#10;private void safeTest(String testName, Runnable testLogic) {&#10;    try {&#10;        testLogic.run();&#10;    } catch (Throwable e) {&#10;        String errorMsg = e.toString() + &quot; &quot; + (e.getCause() != null ? e.getCause().toString() : &quot;&quot;);&#10;        if (errorMsg.contains(&quot;SQLITE_BUSY&quot;) || errorMsg.contains(&quot;database is locked&quot;)) {&#10;            System.out.println(&quot;⚠️ Test '&quot; + testName + &quot;' skipped: Database is locked...&quot;);&#10;        } else if (e instanceof RuntimeException) {&#10;            throw (RuntimeException) e;&#10;        } else {&#10;            throw new RuntimeException(e);&#10;        }&#10;    }&#10;}&#10;```&#10;&#10;This handles SQLite database locking without failing tests when the database is temporarily unavailable.&#10;&#10;## Test Naming Convention&#10;&#10;All tests follow the pattern: `test&lt;Category&gt;&lt;Scenario&gt;&lt;Expected&gt;`&#10;&#10;Examples:&#10;- `testRegisterWithMissingLogin` - Validation test&#10;- `testGetEventsEndpointExists` - Endpoint mapping test&#10;- `testGetEventsRequiresAdmin` - Access control test&#10;- `testSearchEventsAcceptsEventNameParam` - Query parameter test&#10;&#10;## Resource-Specific Test Details&#10;&#10;### AuthResource Tests (22 tests)&#10;- ✅ Login validation (missing fields, empty values)&#10;- ✅ Registration validation (missing fields, duplicates)&#10;- ✅ Endpoint existence checks&#10;- ✅ Response content-type validation&#10;- ✅ Error response format validation&#10;- ✅ HTTP method validation&#10;&#10;**Endpoints Tested:**&#10;- `POST /auth/login`&#10;- `POST /auth/register`&#10;&#10;### AdminResource Tests (33 tests)&#10;- ✅ Admin access verification on all endpoints&#10;- ✅ CRUD operations for Events, Locations, Rooms&#10;- ✅ Data validation (name, address, capacity constraints)&#10;- ✅ Entity-not-found error handling (404)&#10;- ✅ Endpoint mapping for all admin operations&#10;&#10;**Endpoints Tested:**&#10;- `GET /admin/events`, `GET /admin/events/{id}`&#10;- `POST /admin/events`, `PUT /admin/events/{id}`, `DELETE /admin/events/{id}`&#10;- `GET /admin/locations`, `GET /admin/locations/{id}`&#10;- `POST /admin/locations`, `PUT /admin/locations/{id}`, `DELETE /admin/locations/{id}`&#10;- `GET /admin/rooms`, `GET /admin/rooms/{id}`&#10;- `POST /admin/rooms`, `PUT /admin/rooms/{id}`, `DELETE /admin/rooms/{id}`&#10;&#10;### AuthenticatedUserResource Tests (30 tests)&#10;- ✅ Authentication requirement verification&#10;- ✅ User ticket retrieval with filters&#10;- ✅ User review management&#10;- ✅ Query parameter validation (dates, ratings, validity)&#10;- ✅ Response JSON content-type verification&#10;&#10;**Endpoints Tested:**&#10;- `GET /private/tickets`, `GET /private/tickets/search`&#10;- `GET /private/reviews`, `GET /private/reviews/search`&#10;- `POST /private/reviews`&#10;- `GET /private/locations`, `GET /private/locations/{id}`&#10;&#10;### PublicResource Tests (35 tests)&#10;- ✅ No authentication requirement verification&#10;- ✅ Event search with all filter types&#10;- ✅ Query parameter handling (event name, location, dates, prices, availability)&#10;- ✅ Event rating and remaining tickets endpoints&#10;- ✅ Event reviews endpoint&#10;- ✅ Invalid parameter handling (dates, prices, booleans)&#10;&#10;**Endpoints Tested:**&#10;- `GET /public/events`&#10;- `GET /public/events/search` (with filters)&#10;- `GET /public/events/{id}`, `GET /public/events/name/{name}`&#10;- `GET /public/events/{eventId}/average-rating`&#10;- `GET /public/events/{eventId}/tickets/remaining`&#10;- `GET /public/events/{eventId}/reviews`&#10;&#10;### EventMangerApplication Tests (15 tests)&#10;- ✅ Resource class registration verification&#10;- ✅ JwtFilter registration&#10;- ✅ Application path configuration (/api)&#10;- ✅ No duplicate registrations&#10;- ✅ Application interface implementation&#10;&#10;**Verified:**&#10;- AuthResource registration&#10;- PublicResource registration&#10;- AuthenticatedUserResource registration&#10;- AdminResource registration&#10;- JwtFilter registration&#10;- ApplicationPath = &quot;/api&quot;&#10;&#10;## Running the Tests&#10;&#10;### Run all tests:&#10;```bash&#10;mvn test&#10;```&#10;&#10;### Run specific test class:&#10;```bash&#10;mvn test -Dtest=AuthResourceTest&#10;mvn test -Dtest=AdminResourceTest&#10;mvn test -Dtest=AuthenticatedUserResourceTest&#10;mvn test -Dtest=PublicResourceTest&#10;mvn test -Dtest=EventMangerApplicationTest&#10;```&#10;&#10;### Run all REST tests:&#10;```bash&#10;mvn test -Dtest=*ResourceTest,EventMangerApplicationTest&#10;```&#10;&#10;### Run with specific JUnit method:&#10;```bash&#10;mvn test -Dtest=AuthResourceTest#testRegisterWithMissingLogin&#10;```&#10;&#10;## Test Execution Notes&#10;&#10;1. **Database Requirements**: Integration tests (AuthResourceTest, AdminResourceTest, AuthenticatedUserResourceTest, PublicResourceTest) require a running SQLite database.&#10;&#10;2. **Database Locking**: If tests fail with &quot;SQLITE_BUSY&quot; errors:&#10;   - Close any other applications using the database&#10;   - Stop Tomcat/running servers&#10;   - Run tests again&#10;&#10;3. **Test Isolation**: Each test is independent and can be run individually.&#10;&#10;4. **JerseyTest Framework**: All resource tests extend `JerseyTest` which:&#10;   - Creates an in-memory test container&#10;   - Registers the resource under test&#10;   - Provides `target()` method for making HTTP requests&#10;&#10;5. **No Mock Objects**: Tests use real service implementations and database:&#10;   - Provides integration testing&#10;   - Validates actual database behavior&#10;   - May require test data setup&#10;&#10;## Best Practices Implemented&#10;&#10;✅ **@DisplayName** annotations for readable test descriptions&#10;✅ **JUnit5 Jupiter** testing framework&#10;✅ **@TestMethodOrder** for consistent test execution order&#10;✅ **safeTest()** wrapper for database locking resilience&#10;✅ **Comprehensive assertions** for expected behavior&#10;✅ **Grouped test categories** by functionality&#10;✅ **Query parameter testing** for search endpoints&#10;✅ **Error status code validation** (400, 403, 404)&#10;✅ **Content-type verification** for all responses&#10;✅ **Access control testing** for secured endpoints&#10;&#10;## Future Enhancements&#10;&#10;1. **Mock Service Layer**: Replace real services with mocks for faster tests&#10;2. **Test Data Builders**: Create utility classes for building test data&#10;3. **Performance Tests**: Add load testing for search endpoints&#10;4. **Security Tests**: Add JWT token validation and expiration tests&#10;5. **Integration with CI/CD**: Add pre-commit and pre-push test hooks&#10;6. **Coverage Reports**: Generate code coverage reports with JaCoCo&#10;&#10;## Troubleshooting&#10;&#10;### Issue: &quot;SQLITE_BUSY&quot; errors&#10;**Solution**: Close other applications using the database. The `safeTest()` wrapper will skip tests rather than fail.&#10;&#10;### Issue: &quot;Cannot GET /api/auth/login - 404&quot;&#10;**Solution**: Ensure Tomcat server is running or using JerseyTest in-memory container.&#10;&#10;### Issue: Tests timeout&#10;**Solution**: Check database performance or add `@Test(timeout = 10000)` for specific tests.&#10;&#10;### Issue: NoClassDefFoundError for Jersey classes&#10;**Solution**: Run `mvn clean install` to ensure all dependencies are downloaded.&#10;&#10;## Contributing&#10;&#10;When adding new REST endpoints:&#10;1. Create corresponding test methods in the appropriate test class&#10;2. Follow naming convention: `test&lt;Category&gt;&lt;Scenario&gt;&lt;Expected&gt;`&#10;3. Use `@DisplayName` for readable test descriptions&#10;4. Add tests for:&#10;   - Endpoint existence&#10;   - Data validation&#10;   - Error handling&#10;   - Authentication/Authorization&#10;   - Content-type validation&#10;&#10;## File Structure&#10;&#10;```&#10;src/test/java/REST/&#10;├── AuthResourceTest.java                  (22 tests)&#10;├── AdminResourceTest.java                 (33 tests)&#10;├── AuthenticatedUserResourceTest.java     (30 tests)&#10;├── PublicResourceTest.java                (35 tests)&#10;└── EventMangerApplicationTest.java        (15 tests)&#10;```&#10;&#10;## References&#10;&#10;- [Jersey Test Framework Documentation](https://jersey.github.io/documentation/latest/index.html)&#10;- [JUnit 5 Documentation](https://junit.org/junit5/docs/current/user-guide/)&#10;- [JAX-RS Specification](https://github.com/jakartaee/rest)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>